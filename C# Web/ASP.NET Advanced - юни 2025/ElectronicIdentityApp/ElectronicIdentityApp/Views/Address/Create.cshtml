@model ElectronicIdentityApp.ViewModels.Address.CreateAddressViewModel

@{
    ViewData["Title"] = "Add New Address";
}

<div class="container mt-5">
    <div class="card shadow-sm p-4">
        <h2 class="mb-4 text-center text-gradient">Add New Address</h2>

        <form asp-action="Create" method="post">
            <div class="row g-3">

                <!-- City Dropdown -->
                <div class="col-md-6">
                    <label class="form-label">City</label>
                    <select asp-for="CityId" id="CityId" class="form-select select2">
                        <option value="">Select City</option>
                        @foreach (var city in Model.Cities)
                        {
                            <option value="@city.Id">@city.Name</option>
                        }
                    </select>
                    <span asp-validation-for="CityId" class="text-danger"></span>
                </div>

                <!-- Street Dropdown -->
                <div class="col-md-6">
                    <label class="form-label">Street</label>
                    <select asp-for="StreetId" id="StreetId" class="form-select select2">
                        <option value="">Select Street</option>
                    </select>
                    <span asp-validation-for="StreetId" class="text-danger"></span>
                </div>

                <!-- House Number Dropdown -->
                <div class="col-md-6">
                    <label class="form-label">House Number</label>
                    <select asp-for="HouseNumberId" id="HouseNumberId" class="form-select select2">
                        <option value="">Select House Number</option>
                    </select>
                    <span asp-validation-for="HouseNumberId" class="text-danger"></span>
                </div>

                <!-- Postal Code Dropdown -->
                <div class="col-md-6">
                    <label class="form-label">Postal Code</label>
                    <select asp-for="PostCodeId" id="PostCodeId" class="form-select select2">
                        <option value="">Select Postal Code</option>
                    </select>
                    <span asp-validation-for="PostCodeId" class="text-danger"></span>
                </div>

                <!-- IsCurrent Checkbox -->
                <div class="col-md-6 d-flex align-items-center">
                    <div class="form-check mt-3">
                        <input asp-for="IsCurrent" class="form-check-input" />
                        <label asp-for="IsCurrent" class="form-check-label">Is Current Address</label>
                    </div>
                </div>

            </div>

            <div class="text-center mt-4 d-flex justify-content-center gap-3">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fa-solid fa-location-plus me-2"></i> Add Address
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg">
                    <i class="fa-solid fa-arrow-left me-2"></i> Back to Addresses
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('.select2').select2({ placeholder: "Select an option", allowClear: true, width: '100%' });

            // City -> Street
            $('#CityId').on('change', function () {
                var cityName = $("#CityId option:selected").text();
                if (cityName) {
                    $.ajax({
                        url: '@Url.Action("GetStreetsByCity")',
                        type: 'GET',
                        data: { cityName: cityName },
                        success: function (data) {
                            var $streetDropdown = $('#StreetId');
                            $streetDropdown.empty().append('<option value="">Select Street</option>');
                            $.each(data, function (i, street) {
                                $streetDropdown.append('<option value="' + street.id + '">' + street.name + '</option>');
                            });
                            $streetDropdown.trigger('change');
                        }
                    });
                } else {
                    $('#StreetId, #HouseNumberId, #PostCodeId')
                        .empty().append('<option value="">Select option</option>');
                }

                $('#HouseNumberId').empty().append('<option value="">Select House Number</option>');
                $('#PostCodeId').empty().append('<option value="">Select Postal Code</option>');
            });

            // Street -> House Number
            $('#StreetId').on('change', function () {
                var streetName = $("#StreetId option:selected").text();
                var cityName = $("#CityId option:selected").text();
                if (streetName) {
                    $.ajax({
                        url: '@Url.Action("GetHouseNumbersByStreet")',
                        type: 'GET',
                        data: { streetName: streetName, cityName: cityName },
                        success: function (data) {
                            var $houseDropdown = $('#HouseNumberId');
                            $houseDropdown.empty().append('<option value="">Select House Number</option>');
                            $.each(data, function (i, house) {
                                $houseDropdown.append('<option value="' + house.id + '">' + house.name + '</option>');
                            });
                            $houseDropdown.trigger('change');
                        }
                    });
                } else {
                    $('#HouseNumberId').empty().append('<option value="">Select House Number</option>');
                }
                $('#PostCodeId').empty().append('<option value="">Select Postal Code</option>');
            });

            // House Number -> Postal Code
            $('#HouseNumberId').on('change', function () {
                var streetNumber = $("#HouseNumberId option:selected").text();
                var streetName = $("#StreetId option:selected").text();
                var cityName = $("#CityId option:selected").text();

                if (streetNumber && streetName && cityName) {
                    $.ajax({
                        url: '@Url.Action("GetPostCodesByCity")',
                        type: 'GET',
                        data: { cityName: cityName, streetName: streetName, streetNumber: streetNumber },
                        success: function (data) {
                            var $postDropdown = $('#PostCodeId');
                            $postDropdown.empty().append('<option value="">Select Postal Code</option>');
                            $.each(data, function (i, pc) {
                                $postDropdown.append('<option value="' + pc.id + '">' + pc.name + '</option>');
                            });
                            $postDropdown.trigger('change');
                        }
                    });
                } else {
                    $('#PostCodeId').empty().append('<option value="">Select Postal Code</option>');
                }
            });
        });
    </script>

    <style>
        .text-gradient {
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
}
